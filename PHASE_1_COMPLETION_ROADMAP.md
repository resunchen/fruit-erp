# 🎯 Phase 1 完成路线图 (第4周)

## 当前状态

**完成度**: 85%

根据需求分析文档，第1阶段（第1-4周）目标是：
- 完成系统基础架构搭建
- 实现采购、仓储、打包发货核心业务基础流程
- 保障"采购-入库-出库-发货"基础闭环
- 实现批次/每箱/每车成本核算功能

## 📋 第4周必完成任务清单

### 任务1：完成仓储管理模块 (占比20%)

**要求**:
- [x] 入库管理基础功能
- [ ] **扫码入库功能** - 前端扫码输入、后端扫码验证
- [ ] **库存管理面板** - 实时库存显示、多维度查询(品类、批次、保质期)
- [ ] **临期预警** - 保质期到期前7天自动预警
- [x] 出库管理基础功能
- [ ] **FIFO逻辑** - 先进先出原则实现
- [ ] **出库扫码** - 扫码验证出库物品

**关键代码文件**:
- `backend/src/routes/warehouse.routes.ts` - 添加扫码、预警接口
- `backend/src/controllers/warehouseController.ts` - 扫码逻辑、库存计算
- `frontend/src/components/warehouse/BarcodeScanner.tsx` - 新建扫码组件
- `frontend/src/hooks/useWarehouse.ts` - 库存管理hooks
- `frontend/src/pages/warehouse/InventoryDashboard.tsx` - 库存面板

**预计时间**: 2-3天

---

### 任务2：完成打包发货模块 (占比20%)

**要求**:
- [ ] **打包单生成** - 关联订单、打包方案、物料领用
- [ ] **打包物料追踪** - 记录纸箱、泡沫箱、保鲜膜等物料使用
- [ ] **差异化发货** - 整车发货 vs 快递发货逻辑分离
- [ ] **发货单据** - 自动生成发货单、运单、提货单
- [ ] **发货状态追踪** - 待发货 → 运输中 → 已签收

**关键代码文件**:
- `backend/src/routes/packing.routes.ts` - 完善打包、发货接口
- `backend/src/controllers/packingController.ts` - 打包逻辑
- `frontend/src/pages/packing/PackingManagement.tsx` - 打包操作界面
- `frontend/src/components/packing/PackingMaterialForm.tsx` - 物料选择组件
- `frontend/src/pages/shipping/ShippingManagement.tsx` - 发货管理页面

**预计时间**: 2-3天

---

### 任务3：完成成本核算模块关键计算逻辑 (占比30%)

**要求** (按优先级):

#### 优先级1: 每箱成本计算 ⭐⭐⭐
```
每箱成本 = (采购单斤成本 × 平均一箱斤两)
         + 打包物料费(分摊到每箱)
         + 分摊仓储费
         + 分摊运输费
         + 其他费用
```

实现位置:
- `backend/src/services/costCalculationService.ts` - 新建计算服务
- 方法: `calculatePerBoxCost(purchaseOrderId, packingInfo)`

#### 优先级2: 每车成本计算 ⭐⭐⭐
```
每车成本 = Σ(该车装载的所有规格水果的每箱成本)
        + 整车运输费
        + 其他随车成本
```

实现位置:
- `backend/src/services/costCalculationService.ts`
- 方法: `calculatePerTruckCost(truckId, shipmentInfo)`

#### 优先级3: 多维度成本核算 ⭐⭐
支持以下维度的成本和利润核算:
- 批次维度 (按采购批次)
- 品类维度 (按水果品类)
- 客户维度 (按销售客户)
- 订单维度 (按销售订单)

实现位置:
- `backend/src/services/costAnalysisService.ts` - 新建分析服务
- 方法: `analyzeCostByDimension(dimension, filters)`

**关键代码文件**:
- `backend/src/services/costCalculationService.ts` - 新建
- `backend/src/services/costAnalysisService.ts` - 新建
- `backend/src/controllers/costController.ts` - 新建/扩展
- `frontend/src/pages/finance/CostAnalysis.tsx` - 成本分析面板

**预计时间**: 3-4天

---

### 任务4: 端到端集成测试 (占比20%)

**测试场景**:

#### 测试1: 完整采购-入库-出库-发货流程
```
1. 创建采购订单 (AI方式或手动)
2. 验证采购成本计算 (单斤成本、总成本)
3. 货物入库
4. 验证库存显示
5. 生成销售订单
6. 出库打包
7. 验证打包物料追踪
8. 发货
9. 验证每箱/每车成本计算是否正确
```

#### 测试2: 成本数据完整性
```
1. 验证批次成本完整 (采购+运输+仓储+打包+发货)
2. 验证多维度成本分析
3. 验证成本与利润计算准确性
```

#### 测试3: 边界条件
```
1. 部分出库 (一张采购单分多笔发货)
2. 跨批次打包 (不同批次的水果混合打包)
3. 发货延迟 (库存积压计算额外仓储费)
```

**预计时间**: 1-2天

---

### 任务5: 文档与培训材料 (占比10%)

**需要完成**:
- [ ] 系统配置手册 - 参数设置指南
- [ ] 采购成本核算指南 - AI解析配置、成本字段字典维护
- [ ] 成本核算操作指南 - 每箱/每车/多维度成本计算说明
- [ ] 数据备份方案 - 备份策略、恢复流程
- [ ] 基础用户操作指南 - 采购、仓库、打包人员操作手册

**预计时间**: 1-2天

---

## 🎬 实施时间表 (第4周)

**周一-周三** (3天):
- 完成任务1 (仓储模块): 扫码、预警、库存面板
- 完成任务2 (打包发货模块): 物料追踪、发货单据
- 开始任务3 (成本核算): 每箱/每车成本计算

**周四-周五** (2天):
- 完成任务3 (成本核算): 多维度分析、成本预警
- 执行任务4 (集成测试): 完整流程测试、bug修复
- 开始任务5 (文档): 撰写手册

**周末** (可选):
- 完成任务5 (文档): 培训材料定稿
- 最终验收测试
- 总结Week 1-4完成情况

---

## ✅ 第4周完成标志

当以下条件全部满足时，Phase 1完成：

1. ✅ 可以完整演示采购→入库→出库→发货全流程
2. ✅ 每箱/每车成本计算准确
3. ✅ 扫码入库/出库功能可用
4. ✅ 临期预警正常工作
5. ✅ 多维度成本分析可用
6. ✅ 所有核心业务无故障运行（至少8小时无故障）
7. ✅ 文档齐全、培训材料完备

---

## 📦 第4周交付物

### 代码交付
- 完整的warehouse模块代码
- 完整的packing/shipping模块代码
- 完整的cost accounting模块代码
- 100+ 单元测试覆盖关键业务逻辑

### 文档交付
- 系统配置手册
- 成本核算指南
- 采购成本字段词典维护指南
- 用户操作手册（采购、仓库、打包）
- Week 1-4 完成总结报告

### 验收标志
- 演示视频：完整端到端流程
- 测试报告：所有核心场景测试通过
- 性能报告：响应时间、并发能力测试结果

---

## 🔄 与Phase 2 (Week 5-8) 的衔接

完成Phase 1后，将进入Phase 2：**核心管控功能开发**

Phase 2 重点:
- 全环节成本归集与多维度核算优化
- 一码一物追溯管理 (二维码/条形码生成、扫码查询)
- 物料全生命周期管理 (采购、入库、领用、库存、盘点)
- 消息通知系统 (订单审核、库存预警、临期预警)
- 采购计划制定、到货验收、盘点管理完善

---

**状态**: 🟡 进行中 (预计第4周完成)
**负责人**: AI Assistant
**最后更新**: 2025-12-24
