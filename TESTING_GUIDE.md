# 🧪 采购订单 & 供应商管理功能测试指南

## 📋 测试数据概况

已自动生成以下测试数据：
- **5 个供应商** - 来自全国不同地区
- **20 条采购订单** - 随机分配给各供应商
- **38 个订单项目** - 包含各种水果品类和等级
- **46 条成本数据** - 包含产地包装费、代办费、田间杂费等

供应商列表：
1. 山东青岛海洋果业
2. 福建漳州热带水果基地
3. 云南昆明高原果园
4. 浙江杭州滨江果蔬合作社
5. 广西南宁东盟水果市场

---

## 🚀 测试前准备

### 第1步：确保后端服务正在运行

```bash
cd backend
npm run dev
```

输出应该显示：
```
Server running on http://localhost:3000
Environment: development
```

### 第2步：清空浏览器缓存

- **Windows/Linux**: `Ctrl+Shift+Delete`
- **Mac**: `Cmd+Shift+Delete`

选择"所有时间"并点击清除

### 第3步：重启前端应用

```bash
cd frontend
npm run dev
```

### 第4步：访问应用

打开浏览器，访问 `http://localhost:5173`

---

## ✅ 测试场景

### 🎯 测试 1：供应商管理功能

**目标**: 验证供应商列表、查看、添加、编辑、删除功能

#### 步骤 1：查看供应商列表
1. 登录应用
2. 导航到 "供应商管理" 页面
3. **预期结果**: 应该看到 5 个供应商的列表
   - 山东青岛海洋果业
   - 福建漳州热带水果基地
   - 云南昆明高原果园
   - 浙江杭州滨江果蔬合作社
   - 广西南宁东盟水果市场

#### 步骤 2：查看供应商详情
1. 点击任意供应商的 "查看" 或供应商名称
2. **预期结果**: 显示供应商的详细信息
   - 名称
   - 联系人
   - 电话
   - 邮箱
   - 地址
   - 状态

#### 步骤 3：编辑供应商信息
1. 点击 "编辑" 按钮
2. 修改供应商信息（如电话号码、邮箱等）
3. 点击 "保存"
4. **预期结果**:
   - 显示 "编辑成功" 提示
   - 修改后的信息立即生效

#### 步骤 4：添加新供应商
1. 点击 "新增供应商" 按钮
2. 填写表单：
   - 名称: 例如 "浙江绿色果业"
   - 联系人: "张三"
   - 电话: "13999999999"
   - 邮箱: "info@greenfruits.com"
   - 地址: "浙江省杭州市"
3. 点击 "提交"
4. **预期结果**:
   - 显示 "创建成功" 提示
   - 新供应商出现在列表中

#### 步骤 5：删除供应商
1. 点击某个供应商的 "删除" 按钮
2. 确认删除
3. **预期结果**:
   - 供应商从列表中移除
   - 显示 "删除成功" 提示

---

### 🎯 测试 2：采购订单列表功能

**目标**: 验证订单列表、搜索、分页功能

#### 步骤 1：查看采购订单列表
1. 导航到 "采购订单" 页面
2. **预期结果**: 应该看到 20 条采购订单
   - 每条订单显示：订单号、供应商、总金额、状态、创建时间
   - 默认按创建时间倒序排列

#### 步骤 2：测试搜索功能
1. 在搜索框输入订单号的一部分（例如 "PO-"）
2. **预期结果**: 列表自动过滤，显示匹配的订单

#### 步骤 3：测试分页
1. 如果订单超过 10 条，应该看到分页控件
2. 点击下一页/上一页按钮
3. **预期结果**: 正确显示对应页码的订单

---

### 🎯 测试 3：采购订单详情页面

**目标**: 验证订单详情显示、编辑、删除功能

#### 步骤 1：查看订单详情
1. 在订单列表中点击 "查看" 按钮
2. **预期结果**: 显示订单完整信息
   - 订单基本信息（订单号、供应商、创建时间、状态）
   - 订单项目列表（水果品类、数量、单位、单价、总价）
   - 成本数据（成本类型、成本金额）
   - 总金额计算

#### 步骤 2：编辑订单
1. 点击订单详情页的 "编辑" 按钮或列表中的 "编辑"
2. 修改以下信息：
   - 更改供应商
   - 修改订单项目（数量、单价等）
   - 添加或删除成本项
3. 点击 "保存"
4. **预期结果**:
   - 显示 "编辑成功" 提示
   - 订单列表和详情页数据同时更新
   - 总金额自动重新计算

#### 步骤 3：删除订单
1. 在订单列表或详情页点击 "删除"
2. 确认删除操作
3. **预期结果**:
   - 订单从列表中移除
   - 显示 "删除成功" 提示
   - 页面返回订单列表

---

### 🎯 测试 4：创建新订单

**目标**: 验证手动创建订单功能

#### 步骤 1：打开创建订单表单
1. 在订单列表点击 "+ 新增订单" 按钮
2. **预期结果**: 弹出订单创建表单

#### 步骤 2：填写订单信息
1. 选择供应商（必填）
2. 添加订单项目：
   - 水果名称: "榴莲"
   - 数量: "500"
   - 单位: "斤"
   - 单价: "15.5"
3. 添加成本（可选）：
   - 成本类型: "产地包装费"
   - 成本金额: "200"
4. 点击 "提交"
5. **预期结果**:
   - 显示 "创建成功" 提示
   - 新订单出现在列表中
   - 总金额正确计算（500 × 15.5 + 200 = 7950）

---

### 🎯 测试 5：AI 智能创建订单

**目标**: 验证 AI 文本解析功能

#### 步骤 1：打开 AI 创建页面
1. 在订单列表点击 "🤖 AI 智能创建" 按钮
2. **预期结果**: 进入 AI 文本输入页面

#### 步骤 2：测试文本解析
1. 在文本框粘贴以下采购信息：
   ```
   西瓜 13600斤 4.9元/斤 代办费0.05元/斤 中转运费1400元 中转包装2000元
   ```

2. 点击 "解析" 按钮
3. **预期结果**: 应该识别以下信息
   - 商品名称: 西瓜
   - 采购数量: 13600 斤
   - 采购单价: 4.9 元/斤
   - 代办费: 680 元 (0.05 × 13600)
   - 中转运费: 1400 元
   - 中转包装: 2000 元
   - 采购成本: 66640 元 (13600 × 4.9)

#### 步骤 3：确认并创建
1. 点击 "确认并创建订单"
2. 选择供应商
3. 点击 "确认创建"
4. **预期结果**:
   - 显示 "创建成功" 提示
   - 订单出现在列表中
   - 订单包含解析的所有数据

#### 步骤 4：测试不同格式的文本
尝试以下其他格式的文本：
```
葡萄 5000斤 8.5元 选瓜人工500元 卸车费300元
```

```
苹果 2000 15 人工3元/箱 工头费0.5元/箱
```

**预期结果**: AI 都能正确识别各种格式的采购信息

---

## 📊 测试结果评估标准

### ✅ 通过标准

- [ ] 供应商列表正确显示 5 个供应商
- [ ] 能够添加、编辑、删除供应商，无错误
- [ ] 采购订单列表正确显示 20 条订单
- [ ] 搜索和分页功能正常工作
- [ ] 订单详情页显示完整信息
- [ ] 能够创建、编辑、删除订单，无错误
- [ ] 订单总金额计算正确
- [ ] AI 创建订单能正确解析文本
- [ ] 所有 API 请求返回 200/201 状态码（在浏览器 Network 标签中）
- [ ] 没有 404 错误或网络错误
- [ ] 没有 JavaScript 控制台错误

### ⚠️ 警告信号

- ❌ 显示 404 错误
- ❌ 显示 "网络错误"
- ❌ 列表显示为空（数据应该有）
- ❌ API 返回 HTML 而不是 JSON
- ❌ 修改后的数据没有保存
- ❌ 计算结果不正确
- ❌ JavaScript 控制台显示红色错误信息

---

## 🔍 故障排查

### 问题 1：看不到任何订单数据

**可能原因**:
- 后端未运行
- 前端缓存未清空
- 数据库连接失败

**解决方案**:
1. 检查后端是否运行: `npm run dev` in backend 目录
2. 清空浏览器缓存: `Ctrl+Shift+Delete`
3. 检查浏览器开发者工具 Network 标签中的 API 调用
4. 查看浏览器控制台是否有错误信息

### 问题 2：看到 404 错误

**可能原因**: API URL 前缀不正确

**解决方案**:
1. 打开浏览器开发者工具 (F12)
2. 进入 Network 标签
3. 查看请求 URL，应该是 `http://localhost:3000/api/v1/purchase/orders`
4. 如果 URL 不包含 `/api/v1`，说明前端服务未重启

### 问题 3：修改后数据未保存

**可能原因**: 编辑请求失败

**解决方案**:
1. 在浏览器 Network 标签检查 PUT/PATCH 请求状态
2. 查看响应状态码和响应体
3. 检查控制台是否有错误信息

### 问题 4：AI 解析不工作

**可能原因**: AI API 端点未正确配置

**解决方案**:
1. 在 Network 标签检查 `/api/v1/ai/parse-purchase` 请求
2. 确保返回 JSON 而不是 HTML
3. 检查解析的文本格式是否正确

---

## 📸 截图检查清单

测试过程中，建议检查以下页面的截图：

- [ ] 供应商列表页面（显示 5 个供应商）
- [ ] 采购订单列表页面（显示 20 条订单）
- [ ] 订单详情页面（显示完整的订单信息）
- [ ] 创建订单表单（成功创建后）
- [ ] AI 创建页面（解析结果显示）
- [ ] 浏览器 Network 标签（显示正确的 API URLs 和 200/201 状态码）

---

## ✨ 成功标志

当以下条件全部满足时，说明供应商和采购订单模块测试通过：

1. ✅ 能看到 5 个供应商和 20 条订单
2. ✅ 能成功创建、查看、编辑、删除供应商
3. ✅ 能成功创建、查看、编辑、删除订单
4. ✅ 搜索和分页功能正常
5. ✅ AI 文本解析功能正常
6. ✅ 所有计算结果正确
7. ✅ 无 404 或网络错误
8. ✅ 浏览器控制台无红色错误

---

## 📝 反馈清单

测试完成后，请反馈以下信息：

- [ ] 所有基本 CRUD 操作是否正常？
- [ ] 是否有任何功能不工作？
- [ ] 是否有 API 错误或异常？
- [ ] 是否有 UI 显示问题？
- [ ] 性能是否满足预期？
- [ ] 是否需要调整任何功能？

---

**测试日期**: 2025-12-24
**测试数据**: 自动生成
**预期完成时间**: 30-60 分钟

祝测试顺利！🚀
